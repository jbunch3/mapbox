<!-- <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' /> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
/>
<link
  href="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css"
  rel="stylesheet"
/>

<link
  href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css"
  rel="stylesheet"
/>

<script
  src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
  crossorigin=""
></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/Clamp.js/0.5.1/clamp.min.js"
></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>

<style>
  .map {
    width: auto;
    height: 800px;
  }

  .map-container {
    width: 100%;
    overflow: visible;
    position: relative;
  }

  .map-overlay {
    font: 12px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
    background-color: #fff;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    position: absolute;
    width: 35%;
    top: 5%;
    left: -5%;
    padding: 15px;
    display: none;
  }

  .no-margin {
    margin: 10px 0 0 0 !important;
  }

  @media only screen and (max-width: 700px) {
    .map {
      width: auto;
      height: 400px;
    }

    .map-overlay {
      font: 12px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
      background-color: #fff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      border-radius: 3px;
      position: relative;
      width: 100%;
      top: -100%;
      left: 0%;
      padding: 15px;
      display: none;
    }

    .map-container {
      position: relative;
    }

    .legendMobile {
      background-color: #fff;
      display: none;
      border-radius: 3px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      font: 14px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
      padding: 10px;
      position: relative;
      width: 100%;
      top: 0%;
      left: 0%;
      vertical-align: middle;
    }
  }

  .mapboxgl-popup {
    max-width: 400px;
    font: 12px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
  }

  .legend {
    max-width: 200px;
    display: none;
    background-color: #fff;
    border-radius: 3px;
    top: 10px;
    left: 10px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    font: 14px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
    padding: 10px;
    position: absolute;
    vertical-align: middle;
  }

  .legendMobile {
    background-color: #fff;
    display: none;
    border-radius: 3px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    font: 14px/20px "Helvetica Neue", Arial, Helvetica, sans-serif;
    padding: 10px;
    position: relative;
    width: 100%;
    top: 0%;
    left: 0%;
    vertical-align: middle;
  }

  .legend h4 {
    margin: 0 0 10px;
  }

  .legendMobile h4 {
    margin: 0 0 10px;
  }

  @import url("https://fonts.googleapis.com/css?family=Open+Sans");

  .topdestination {
    color: #cc0000;
    font-size: medium;
    font-style: normal;
    font-weight: 800;
    font-family: "Open Sans Bold", sans-serif;
  }

  .worthyourtime {
    color: #cc0000;
    font-size: medium;
    font-style: normal;
    font-weight: 400;
    font-family: "Open Sans Semibold", sans-serif;
  }

  .specialinterest {
    font-size: small;
    font-style: normal;
    font-weight: 200;
    font-family: "Open Sans", sans-serif;
  }

  .naturallandscape {
    color: #285c3a;
    font-size: medium;
    font-style: italic;
    font-weight: 800;
    font-family: "Open Sans Semibold", sans-serif;
  }

  .legend div span {
    display: inline-block;
    vertical-align: middle;
    height: 15px;
    margin-right: 5px;
    width: 15px;
  }

  .legendMobile div span {
    display: inline-block;
    vertical-align: middle;
    height: 15px;
    margin-right: 5px;
    width: 15px;
  }

  .button-59 {
    align-items: center;
    background-color: #fff;
    border: 2px solid #000;
    box-sizing: border-box;
    color: #000;
    cursor: pointer;
    display: inline-flex;
    fill: #000;
    font-family: Inter, sans-serif;
    font-size: 16px;
    font-weight: 600;
    height: 48px;
    justify-content: center;
    letter-spacing: -0.8px;
    line-height: 24px;
    min-width: 100px;
    outline: 0;
    padding: 0 17px;
    text-align: center;
    text-decoration: none;
    transition: all 0.3s;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .button-59:focus {
    color: rgb(53, 88, 139);
  }

  .button-59:hover {
    background-color: rgb(167, 167, 167);
    border-color: rgb(53, 88, 139);
    color: rgb(53, 88, 139);
    fill: rgb(53, 88, 139);
  }

  .button-59:active {
    background-color: rgb(53, 88, 139);
    border-color: rgb(53, 88, 139);
    color: rgb(53, 88, 139);
    fill: rgb(53, 88, 139);
  }

  @media (min-width: 768px) {
    .button-59 {
      min-width: 100px;
    }
  }
</style>

<div class="map-container">
  <div id="map" class="map"></div>
  <div id="legend" class="legend"></div>
  <div id="legendMobile" class="legendMobile"></div>
  <div id="map-overlay" class="map-overlay"></div>
</div>

<script>
  var wikiLogo =
    "https://cityscape-travel.com/wp-content/uploads/2023/09/Wikipedias_W.svg-1.png";

  function getPlaceOfInterestSidebarHtml(feature) {
    if (feature.properties && feature.properties.title) {
      var dates = "";
      if (feature.properties.dates) {
        dates =
          '<div class="no-margin"><p><b>Dates: </b>' +
          feature.properties.dates +
          "</p></div>";
      }

      var architect = "";
      if (feature.properties.architect) {
        architect =
          '<div class="no-margin"><p><b>Architect: </b>' +
          feature.properties.architect +
          "</p></div>";
      }

      var style = "";
      if (feature.properties.style) {
        style =
          '<div class="no-margin"><p><b>Style: </b>' +
          feature.properties.style +
          "</p></div>";
      }

      var description = "";
      if (feature.properties.description) {
        description =
          '<div class="no-margin"><p><b>Description: </b>' +
          feature.properties.description +
          "</p></div>";
      }

      var details = "";
      if (feature.properties.details) {
        details =
          '<div class="no-margin"><p>' +
          feature.properties.details +
          "</p></div>";
      }

      var sideBar =
        '<div class="container">' +
        '<img class="infoImg" src="' +
        feature.properties.pictureUrl +
        '"/></div>' +
        '<h2 class="no-margin">' +
        feature.properties.title +
        "</h2>" +
        dates +
        architect +
        style +
        description +
        details +
        '<div class="center"><a href="' +
        feature.properties.wikiUrl +
        '" id="discButton' +
        feature.id +
        '" class="button-59" role="button">Discover More</button></div>';
      return sideBar;
    }
  }

  function getLegend() {
    return `<h4>Legend</h4>
            <div class="worthyourtime">Top Destinations</div>
            <div class="specialinterest">Special Interest</div>
            <br />
            <div>
                <svg
                version="1.1"
                id="castle"
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 15 15"
                >
                <path
                    d="M11,4H4C3.4477,4,3,3.5523,3,3V0.5C3,0.2239,3.2239,0,3.5,0S4,0.2239,4,0.5V2h1V1c0-0.5523,0.4477-1,1-1s1,0.4477,1,1v1h1V1
    c0-0.5523,0.4477-1,1-1s1,0.4477,1,1v1h1V0.5C11,0.2239,11.2239,0,11.5,0S12,0.2239,12,0.5V3C12,3.5523,11.5523,4,11,4z M14,14.5
    c0,0.2761-0.2239,0.5-0.5,0.5h-12C1.2239,15,1,14.7761,1,14.5S1.2239,14,1.5,14H2c0.5523,0,1-0.4477,1-1c0,0,1-6,1-7
    c0-0.5523,0.4477-1,1-1h5c0.5523,0,1,0.4477,1,1c0,1,1,7,1,7c0,0.5523,0.4477,1,1,1h0.5c0.2723-0.0001,0.4946,0.2178,0.5,0.49V14.5z
        M9,10.5C9,9.6716,8.3284,9,7.5,9S6,9.6716,6,10.5V14h3V10.5z"
                />
                </svg>
                Castle or Palace
            </div>
            <div>
                <svg version="1.1" id="beer" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15">
                    <path d="M12,5V2c0,0-1-1-4.5-1S3,2,3,2v3c0.0288,1.3915,0.3706,2.7586,1,4c0.6255,1.4348,0.6255,3.0652,0,4.5c0,0,0,1,3.5,1
    s3.5-1,3.5-1c-0.6255-1.4348-0.6255-3.0652,0-4.5C11.6294,7.7586,11.9712,6.3915,12,5z M7.5,13.5
    c-0.7966,0.035-1.5937-0.0596-2.36-0.28c0.203-0.7224,0.304-1.4696,0.3-2.22h4.12c-0.004,0.7504,0.097,1.4976,0.3,2.22
    C9.0937,13.4404,8.2966,13.535,7.5,13.5z M7.5,5C6.3136,5.0299,5.1306,4.8609,4,4.5v-2C5.131,2.1411,6.3137,1.9722,7.5,2
    C8.6863,1.9722,9.869,2.1411,11,2.5v2C9.8694,4.8609,8.6864,5.0299,7.5,5z"/>
                </svg>
                Famous Brewery
            </div>
            <div>
                <svg
                version="1.1"
                id="religious-christian"
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 15 15"
                >
                <path
                    id="rect3338"
                    d="M6,0.9552V4H3v3h3v8h3V7h3V4H9V1
    c0-1-0.9776-1-0.9776-1H6.9887C6.9887,0,6,0,6,0.9552z"
                />
                </svg>
                Church or Monastery
            </div>
            <div>
                <svg
                version="1.1"
                id="monument"
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 15 15"
                >
                <path
                    id="path11719-7"
                    d="M7.5,0L6,2.5v7h3v-7L7.5,0z M3,11.5
    L3,15h9v-3.5L10.5,10h-6L3,11.5z"
                />
                </svg>
                Place of Interest
            </div>
            <div>
                <svg
                version="1.1"
                id="museum"
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 15 15"
                >
                <path
                    id="path7509"
                    d="M7.5,0L1,3.5V4h13V3.5L7.5,0z M2,5v5l-1,1.6V13h13v-1.4L13,10V5H2z M4,6h1v5.5H4V6z M7,6h1v5.5H7V6z M10,6h1
    v5.5h-1V6z"
                />
                </svg>
                Museum
            </div>
            <div>
                <svg
                id="viewpoint"
                xmlns="http://www.w3.org/2000/svg"
                width="15"
                height="15"
                viewBox="0 0 15 15"
                >
                <path
                    id="cf3b542b-d2af-4732-9b92-9e3dc05e460f"
                    d="M6.02,8.425a2.3859,2.3859,0,0,0-.46.44l-4.55-3.5a7.9976,7.9976,0,0,1,1.51-1.51Zm6.46-4.56-3.5,4.55a2.3971,2.3971,0,0,1,.45.45l4.56-3.5A7.945,7.945,0,0,0,12.48,3.865ZM7.3042,10.0129a1.5,1.5,0,1,0,1.6829,1.2914h0A1.5,1.5,0,0,0,7.3042,10.0129ZM6.43,2.235a7.9329,7.9329,0,0,0-2.06.55l2.2,5.32a2.0438,2.0438,0,0,1,.61-.17Zm2.14.01-.75,5.69a2.49,2.49,0,0,1,.61.16l2.2-5.3A7.2129,7.2129,0,0,0,8.57,2.245Z"
                />
                </svg>
                Viewpoint
            </div>
            `;
  }

  var currentLocation = window.location.href;

  mapboxgl.accessToken =
    "pk.eyJ1IjoiamNidW5jaDMiLCJhIjoiY2t6NzM0em9uMGlvbzMwbWdkbmR5N2loaCJ9.eKquRAbhpJDDshFFKtd9Yw";

  if (window.innerWidth <= 991) {
    var mobileMapLayer = "mapbox://styles/jcbunch3/clmkcryap00ch01pdfr4m9icp";
    const map = new mapboxgl.Map({
      container: "map", // HTML container ID
      style: mobileMapLayer, // style URL
      center: [8.8, 52.6], // starting position as [lng, lat]
      zoom: 4,
    });

    map.on("load", () => {
      map.addSource("places", {
        type: "vector",
        url: "mapbox://jcbunch3.clmkcdnfg190v2amtzs57aoql-6s182",
      });

      const overlay = document.getElementById("legendMobile");
      const mapoverlay = document.getElementById("map-overlay");
      overlay.style.display = "block";
      overlay.innerHTML = getLegend();

      map.addLayer({
        id: "points",
        type: "circle",
        source: "places",
        "source-layer": "UrbanPlacesToVisit",
        paint: {
          "circle-radius": 10,
          "circle-opacity": 0,
        },
      });

      map.on("click", "points", (e) => {
        const feature = e.features[0];
        mapoverlay.style.display = "block";
        mapoverlay.innerHTML = getPlaceOfInterestSidebarHtml(feature);
        overlay.style.display = "none";
      });
      // Change the cursor to a pointer when the mouse is over the places layer.
      map.on("mouseenter", "points", () => {
        map.getCanvas().style.cursor = "pointer";
      });

      // Change it back to a pointer when it leaves.
      map.on("mouseleave", "points", () => {
        map.getCanvas().style.cursor = "";
      });

      function openWikiURL(e, feature) {
        window.open(feature.properties.wikiUrl);
      }

      map.on("zoomstart", function () {
        mapoverlay.style.display = "none";
        overlay.style.display = "block";
      });

      map.addControl(new mapboxgl.NavigationControl(), "top-right");
      map.addControl(new mapboxgl.FullscreenControl(), "top-right");
    });

    if (currentLocation.includes("bamberg")) {
      map.setCenter([10.888, 49.895]);
      map.setZoom(12);
    }
  } else {
    // ---------------------------------------------------------------------------------------------------------------------------------------------------
    // ---------------------------------------------------------------------------------------------------------------------------------------------------
    // ---------------------------------------------------------------------------------------------------------------------------------------------------

    var desktopMapLayer = "mapbox://styles/jcbunch3/clmkcryap00ch01pdfr4m9icp";
    const map = new mapboxgl.Map({
      container: "map", // HTML container ID
      style: desktopMapLayer, // style URL
      center: [8.8, 52.4], // starting position as [lng, lat]
      zoom: 5.1,
    });

    map.on("load", () => {
      map.addSource("places", {
        type: "vector",
        url: "mapbox://jcbunch3.clmkcdnfg190v2amtzs57aoql-6s182",
      });

      const overlay = document.getElementById("legend");
      const mapoverlay = document.getElementById("map-overlay");
      overlay.style.display = "block";
      overlay.innerHTML = getLegend();

      map.addLayer({
        id: "points",
        type: "circle",
        source: "places",
        "source-layer": "UrbanPlacesToVisit",
        paint: {
          "circle-radius": 10,
          "circle-opacity": 0,
        },
      });

      map.on("click", "points", (e) => {
        const feature = e.features[0];
        mapoverlay.style.display = "block";
        mapoverlay.innerHTML = getPlaceOfInterestSidebarHtml(feature);
        overlay.style.display = "none";
      });

      // Change the cursor to a pointer when the mouse is over the places layer.
      map.on("mouseenter", "points", () => {
        map.getCanvas().style.cursor = "pointer";
      });

      // Change it back to a pointer when it leaves.
      map.on("mouseleave", "points", () => {
        map.getCanvas().style.cursor = "";
      });

      map.on("zoomstart", function () {
        mapoverlay.style.display = "none";
        overlay.style.display = "block";
      });

      function openWikiURL(e, feature) {
        window.open(feature.properties.wikiUrl);
      }

      map.addControl(new mapboxgl.NavigationControl(), "top-right");
      map.addControl(new mapboxgl.FullscreenControl(), "top-right");
    });

    if (currentLocation.includes("bamberg")) {
      map.setCenter([10.888, 49.895]);
      map.setZoom(14);
    }
  }
</script>
